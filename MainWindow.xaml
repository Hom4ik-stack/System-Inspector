<Window x:Class="SecurityShield.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
        xmlns:converters="clr-namespace:SecurityShield.Converters"
        xmlns:local="clr-namespace:SecurityShield"
        mc:Ignorable="d"
        Title="System Inspector"
        Height="800" Width="1200"
        WindowStartupLocation="CenterScreen"
        Background="#FFF0F0F0">

    <Window.Resources>
        <!-- Конвертеры -->
        <converters:BytesToGBConverter x:Key="BytesToGBConverter"/>
        <converters:SeverityToColorConverter x:Key="SeverityToColorConverter"/>
        <converters:BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:InverseBooleanConverter x:Key="InverseBooleanConverter"/>
        <converters:BoolToTextConverter x:Key="BoolToTextConverter"/>
        <converters:ContainsStringVisibilityConverter x:Key="ContainsStringVisibilityConverter"/>

        <!-- Стили -->
        <Style TargetType="TextBlock">
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontSize" Value="12"/>
        </Style>

        <!-- Стиль для кнопки завершения процесса -->
        <Style x:Key="KillButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#FF28A745"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Background" Value="#FF6C757D"/>
                    <Setter Property="Foreground" Value="#FFE9ECEF"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="PropertiesButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#FF6F42C1"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>

        <Style TargetType="Button">
            <Setter Property="Background" Value="#FF0078D7"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>

        <Style TargetType="TabControl">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>

        <Style TargetType="TabItem">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="15,8"/>
        </Style>

        <!-- Стиль для кнопки обновления драйвера -->
        <Style x:Key="UpdateButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#FF28A745"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Background" Value="#FF6C757D"/>
                    <Setter Property="Foreground" Value="#FFE9ECEF"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Стиль для кнопки извлечения устройства -->
        <Style x:Key="EjectButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#FF6F42C1"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>

        <!-- Стиль для кнопки настроек устройства -->
        <Style x:Key="SettingsButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#FF17A2B8"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>

        <!-- Стиль для уязвимостей -->
        <Style x:Key="VulnerabilityItemStyle" TargetType="Border">
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#FFDEE2E6"/>
            <Setter Property="Background" Value="#FFF8F9FA"/>
            <Setter Property="Margin" Value="0,2"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="CornerRadius" Value="4"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Заголовок -->
        <Border Grid.Row="0" Background="#FF2D2D30" Padding="15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock Text="🛡️" FontSize="20" Margin="0,0,10,0"/>
                    <TextBlock Text="System Inspector"
                              Foreground="White" FontSize="16" FontWeight="Bold"/>
                </StackPanel>

                <TextBlock Grid.Column="1" Text="{Binding ScanStatus}"
                          Foreground="LightYellow" HorizontalAlignment="Center"
                          VerticalAlignment="Center" FontWeight="SemiBold"/>

                <TextBlock Grid.Column="2" Text="{Binding CurrentTime}"
                          Foreground="LightGray" VerticalAlignment="Center"/>
            </Grid>
        </Border>

        <!-- Вкладки -->
        <TabControl Grid.Row="1" Margin="10">
            <!-- Вкладка 1: О системе -->
            <TabItem Header="О системе">
                <ScrollViewer>
                    <StackPanel Margin="15">
                        <TextBlock Text="Информация о системе" FontSize="16" FontWeight="Bold" Margin="0,0,0,10"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Версия ОС:" FontWeight="Bold" Margin="0,5"/>
                            <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding SystemInfo.OSVersion}" Margin="10,5"/>

                            <TextBlock Grid.Row="0" Grid.Column="2" Text="Имя компьютера:" FontWeight="Bold" Margin="20,5,0,5"/>
                            <TextBlock Grid.Row="0" Grid.Column="3" Text="{Binding SystemInfo.ComputerName}" Margin="10,5"/>

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Сборка:" FontWeight="Bold" Margin="0,5"/>
                            <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding SystemInfo.Build}" Margin="10,5"/>

                            <TextBlock Grid.Row="1" Grid.Column="2" Text="Доменная группа:" FontWeight="Bold" Margin="20,5,0,5"/>
                            <TextBlock Grid.Row="1" Grid.Column="3" Text="{Binding SystemInfo.Domain}" Margin="10,5"/>

                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Состояние обновлений:" FontWeight="Bold" Margin="0,5"/>
                            <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding SystemInfo.UpdateStatus}" Margin="10,5"/>

                            <TextBlock Grid.Row="2" Grid.Column="2" Text="Пользователь:" FontWeight="Bold" Margin="20,5,0,5"/>
                            <TextBlock Grid.Row="2" Grid.Column="3" Text="{Binding SystemInfo.UserName}" Margin="10,5"/>

                            <TextBlock Grid.Row="3" Grid.Column="0" Text="Оперативная память:" FontWeight="Bold" Margin="0,5"/>
                            <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding SystemInfo.TotalRAM}" Margin="10,5"/>

                            <TextBlock Grid.Row="3" Grid.Column="2" Text="Материнская плата:" FontWeight="Bold" Margin="20,5,0,5"/>
                            <TextBlock Grid.Row="3" Grid.Column="3" Text="{Binding SystemInfo.Motherboard}" Margin="10,5"/>

                            <TextBlock Grid.Row="4" Grid.Column="0" Text="Процессор:" FontWeight="Bold" Margin="0,5"/>
                            <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding SystemInfo.Processor}" Margin="10,5"/>

                            <TextBlock Grid.Row="4" Grid.Column="2" Text="BIOS:" FontWeight="Bold" Margin="20,5,0,5"/>
                            <TextBlock Grid.Row="4" Grid.Column="3" Text="{Binding SystemInfo.BIOS}" Margin="10,5"/>

                            <TextBlock Grid.Row="5" Grid.Column="0" Text="Сетевые адаптеры:" FontWeight="Bold" Margin="0,5"/>
                            <StackPanel Grid.Row="5" Grid.Column="1" Grid.ColumnSpan="3" Margin="10,5">
                                <ItemsControl ItemsSource="{Binding SystemInfo.NetworkAdapters}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding}" Margin="0,1"/>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </Grid>
                        <GroupBox Header="Установленное программное обеспечение" Margin="0,20,0,0">
                            <DataGrid ItemsSource="{Binding InstalledSoftware}"
              AutoGenerateColumns="False"
              IsReadOnly="True"
              MaxHeight="300"
              ScrollViewer.VerticalScrollBarVisibility="Auto">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Название" Binding="{Binding DisplayName}" Width="3*"/>
                                    <DataGridTextColumn Header="Версия" Binding="{Binding DisplayVersion}" Width="1*"/>
                                    <DataGridTextColumn Header="Издатель" Binding="{Binding Publisher}" Width="2*"/>
                                    <DataGridTextColumn Header="Дата установки" Binding="{Binding InstallDate}" Width="1*"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Вкладка 2: Производительность -->
            <TabItem Header="Производительность">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="2*"/>
                    </Grid.RowDefinitions>

                    <!-- Информация о процессах -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="10">
                        <TextBlock Text="Активных процессов:" FontWeight="Bold" Margin="0,0,5,0"/>
                        <TextBlock Text="{Binding TotalProcessesCount}" FontWeight="Bold" Foreground="Blue"/>
                        <TextBlock Text=" (все работающие процессы системы)"
                                  FontStyle="Italic" Margin="10,0,0,0" Foreground="Gray"/>
                    </StackPanel>

                    <!-- График загрузки ЦП -->
                    <GroupBox Grid.Row="1" Header="Загрузка ЦП в реальном времени" Margin="10">
                        <lvc:CartesianChart Series="{Binding CpuSeries}" LegendLocation="None" Hoverable="False">
                            <lvc:CartesianChart.AxisX>
                                <lvc:Axis Title="Время (секунды)" LabelsRotation="15">
                                    <lvc:Axis.Separator>
                                        <lvc:Separator Step="1"></lvc:Separator>
                                    </lvc:Axis.Separator>
                                </lvc:Axis>
                            </lvc:CartesianChart.AxisX>
                            <lvc:CartesianChart.AxisY>
                                <lvc:Axis Title="Загрузка (%)" MinValue="0" MaxValue="100">
                                    <lvc:Axis.Separator>
                                        <lvc:Separator Step="10"></lvc:Separator>
                                    </lvc:Axis.Separator>
                                </lvc:Axis>
                            </lvc:CartesianChart.AxisY>
                        </lvc:CartesianChart>
                    </GroupBox>

                    <!-- Список процессов -->
                    <GroupBox Grid.Row="2" Header="Все активные процессы системы" Margin="10">
                        <DataGrid ItemsSource="{Binding Processes}"
                                  AutoGenerateColumns="False"
                                  IsReadOnly="True"
                                  ScrollViewer.VerticalScrollBarVisibility="Auto"
                                  SelectionMode="Single"
                                  EnableRowVirtualization="True"
                                  EnableColumnVirtualization="True"
                                  MaxHeight="600">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Имя процесса" Binding="{Binding Name}" Width="2*"/>
                                <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="0.5*"/>
                                <DataGridTextColumn Header="ЦП (%)" Binding="{Binding Cpu, StringFormat=F1}" Width="0.8*">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Cpu}" Value="50">
                                                    <Setter Property="Foreground" Value="Red"/>
                                                    <Setter Property="FontWeight" Value="Bold"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Cpu}" Value="20">
                                                    <Setter Property="Foreground" Value="Orange"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="Память (МБ)" Binding="{Binding MemoryMB, StringFormat=F1}" Width="1*">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding MemoryMB}" Value="500">
                                                    <Setter Property="Foreground" Value="Red"/>
                                                    <Setter Property="FontWeight" Value="Bold"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding MemoryMB}" Value="100">
                                                    <Setter Property="Foreground" Value="Orange"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="Путь" Binding="{Binding ProcessPath}" Width="3*"/>
                                <DataGridTextColumn Header="Тип" Width="1*">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="HorizontalAlignment" Value="Center"/>
                                            <Setter Property="FontWeight" Value="SemiBold"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsUserProcess}" Value="True">
                                                    <Setter Property="Foreground" Value="Green"/>
                                                    <Setter Property="Text" Value="Пользовательский"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding IsUserProcess}" Value="False">
                                                    <Setter Property="Foreground" Value="Red"/>
                                                    <Setter Property="Text" Value="Системный"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTemplateColumn Header="Действия" Width="1.2*">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Button Content="Завершить"
                                                    Command="{Binding DataContext.KillProcessCommand, 
                                                        RelativeSource={RelativeSource AncestorType=Window}}"
                                                    CommandParameter="{Binding}"
                                                    Style="{StaticResource KillButtonStyle}"
                                                    ToolTip="Завершить процесс (только пользовательские процессы)"
                                                    Visibility="{Binding IsUserProcess, 
                                                        Converter={StaticResource BoolToVisibilityConverter}}"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>

                            <!-- Подсветка строк для пользовательских процессов -->
                            <DataGrid.RowStyle>
                                <Style TargetType="DataGridRow">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsUserProcess}" Value="True">
                                            <Setter Property="Background" Value="#FFE8F5E8"/>
                                            <Setter Property="ToolTip" Value="Этот процесс можно безопасно завершить"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding IsUserProcess}" Value="False">
                                            <Setter Property="Background" Value="#FFFFE6E6"/>
                                            <Setter Property="ToolTip" Value="Системный процесс - НЕ рекомендуется завершать"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGrid.RowStyle>
                        </DataGrid>
                    </GroupBox>
                </Grid>
            </TabItem>

            <!-- Вкладка 3: Память -->
            <TabItem Header="Память">
                <ScrollViewer>
                    <StackPanel Margin="10">
                        <TextBlock Text="Информация о дисках" FontSize="16" FontWeight="Bold" Margin="0,0,0,10"/>
                        <ItemsControl ItemsSource="{Binding Drives}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <GroupBox Header="{Binding Name}" Margin="0,5" Padding="10">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Информация о диске -->
                                            <StackPanel Grid.Column="0">
                                                <TextBlock Text="{Binding DriveType}" FontWeight="Bold"/>
                                                <TextBlock Text="{Binding DriveFormat}"/>
                                                <TextBlock Text="{Binding TotalSpaceFormatted, StringFormat='Общий размер: {0}'}"/>
                                                <TextBlock Text="{Binding FreeSpaceFormatted, StringFormat='Свободно: {0}'}"/>

                                                <TextBlock Text="{Binding UsedSpaceFormatted, StringFormat='Использовано: {0}'}"/>
                                                <TextBlock Text="{Binding UsedPercentage, StringFormat='Заполнение: {0:F1}%', Mode=OneWay}"/>
                                                <!-- Прогресс-бар -->
                                                <ProgressBar Value="{Binding UsedPercentage, Mode=OneWay}"
                                                            Maximum="100"
                                                            Height="20"
                                                            Margin="0,5,0,0">
                                                    <ProgressBar.Style>
                                                        <Style TargetType="ProgressBar">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding UsedPercentage}" Value="90">
                                                                    <Setter Property="Foreground" Value="Red"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding UsedPercentage}" Value="75">
                                                                    <Setter Property="Foreground" Value="Orange"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding UsedPercentage}" Value="50">
                                                                    <Setter Property="Foreground" Value="Green"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </ProgressBar.Style>
                                                </ProgressBar>
                                                <Button Content="  📁   Открыть в Проводнике"
                                                    Command="{Binding DataContext.OpenDriveInExplorerCommand, 
                                                    RelativeSource={RelativeSource AncestorType=Window}}"
                                                    CommandParameter="{Binding}"
                                                    Margin="0,10,0,0" HorizontalAlignment="Left"
                                                    Background="#FF17A2B8"/>
                                            </StackPanel>

                                            <lvc:PieChart Grid.Column="1"
                                                         Width="150"
                                                         Height="150"
                                                         Margin="10,0,0,0"
                                                         Series="{Binding DriveSeries}"
                                                         Hoverable="False">
                                            </lvc:PieChart>
                                        </Grid>
                                    </GroupBox>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Вкладка 4: Драйверы -->
            <TabItem Header="Драйверы">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Панель управления драйверами -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="15,10">
                        <Button Content="Обновить список драйверов" 
                    Command="{Binding LoadDriversCommand}" 
                    Margin="0,0,10,0"/>
                        <Button Content="Проверить обновления драйверов" 
                    Command="{Binding CheckDriverUpdatesCommand}" 
                    Margin="0,0,10,0"/>

                        <TextBlock Text="Статус:" VerticalAlignment="Center" Margin="10,0,5,0"/>
                        <TextBlock Text="{Binding DriverStatus}" VerticalAlignment="Center" 
                       FontWeight="SemiBold" Foreground="Blue"/>
                    </StackPanel>

                    <!-- Список драйверов -->
                    <GroupBox Grid.Row="1" Header="Установленные драйверы" Margin="10">
                        <DataGrid ItemsSource="{Binding Drivers}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      ScrollViewer.VerticalScrollBarVisibility="Auto">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Имя драйвера" Binding="{Binding Name}" Width="3*"/>
                                <DataGridTextColumn Header="Производитель" Binding="{Binding Manufacturer}" Width="2*"/>
                                <DataGridTextColumn Header="Версия" Binding="{Binding Version}" Width="1*"/>
                                <DataGridTextColumn Header="Дата" Binding="{Binding Date}" Width="1*"/>
                                <DataGridTextColumn Header="Класс" Binding="{Binding Class}" Width="1*"/>
                                <DataGridTextColumn Header="Статус" Binding="{Binding UpdateStatus}" Width="1.5*">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="FontWeight" Value="SemiBold"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsOutdated}" Value="True">
                                                    <Setter Property="Foreground" Value="#FFDC3545"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding IsOutdated}" Value="False">
                                                    <Setter Property="Foreground" Value="#FF28A745"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </GroupBox>
                </Grid>
            </TabItem>

            <!-- Вкладка 5: Устройства -->
            <TabItem Header="Устройства">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="15,10">

                        <TextBlock Text="Статус:" VerticalAlignment="Center" Margin="10,0,5,0" FontWeight="Bold"/>
                        <TextBlock Text="{Binding DeviceStatus}" VerticalAlignment="Center"
FontWeight="SemiBold" Foreground="Blue"/>
                    </StackPanel>

                    <TabControl Grid.Row="1" Margin="10">

                        <TabItem Header=" 🔌  Подключенные устройства">
                            <DataGrid ItemsSource="{Binding DisplayedDevices}"
                  AutoGenerateColumns="False"
                  IsReadOnly="True"
                  ScrollViewer.VerticalScrollBarVisibility="Auto">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Устройство" Binding="{Binding Name}" Width="2.5*"/>
                                    <DataGridTextColumn Header="Тип" Binding="{Binding Category}" Width="1.2*"/>
                                    <DataGridTextColumn Header="Производитель" Binding="{Binding Manufacturer}" Width="1.5*"/>
                                    <DataGridTextColumn Header="Статус" Binding="{Binding Status}" Width="1*"/>
                        
                                    <DataGridTemplateColumn Header="Действия" Width="2*">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal">
                                                    <Button Content=" ⚙ ️ Настройки"
                                        Command="{Binding DataContext.OpenDevicePropertiesCommand,
                                        RelativeSource={RelativeSource AncestorType=Window}}"
                                        CommandParameter="{Binding}"
                                        Style="{StaticResource SettingsButtonStyle}"
                                        Margin="0,0,5,0"
                                        ToolTip="Открыть настройки устройства"/>
                                                    <Button Content=" ⏏ ️ Извлечь"
                                        Command="{Binding DataContext.EjectDeviceCommand,
                                        RelativeSource={RelativeSource AncestorType=Window}}"
                                        CommandParameter="{Binding}"
                                        Style="{StaticResource EjectButtonStyle}"
                                        Visibility="{Binding IsRemovable,
                                        Converter={StaticResource BoolToVisibilityConverter}}"
                                        ToolTip="Безопасное извлечение устройства"/>
                                                </StackPanel>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </DataGrid.Columns>
                            </DataGrid>
                        </TabItem>


                 <!--        <TabItem Header="  🌐   Сетевые подключения (Netstat)">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5">
                                    <Button Content="  🔄   Обновить подключения"
                                Command="{Binding LoadNetworkConnectionsCommand}"/>
                                    <TextBlock TextWrapping="Wrap" VerticalAlignment="Center" Margin="10,0" FontStyle="Italic" Foreground="Gray">
                            Показывает установленные подключения к внешним серверам (кроме localhost).
                                    </TextBlock>
                                </StackPanel>

                                <DataGrid Grid.Row="1" ItemsSource="{Binding NetworkConnections}"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              ScrollViewer.VerticalScrollBarVisibility="Auto">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Процесс (PID)" Width="1.5*">
                                            <DataGridTextColumn.Binding>
                                                <MultiBinding StringFormat="{}{0} ({1})">
                                                    <Binding Path="ProcessName"/>
                                                    <Binding Path="ProcessId"/>
                                                </MultiBinding>
                                            </DataGridTextColumn.Binding>
                                        </DataGridTextColumn>
                                        <DataGridTextColumn Header="Внешний адрес" Binding="{Binding RemoteAddress}" Width="2*"/>
                                        <DataGridTextColumn Header="Удаленный порт" Binding="{Binding RemotePortDescription}" Width="1.5*"/>
                                        <DataGridTextColumn Header="Назначение" Binding="{Binding ConnectionPurpose}" Width="2*"/>
                                        <DataGridTextColumn Header="Локальный порт" Binding="{Binding LocalPortDescription}" Width="2*"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </Grid>
                        </TabItem>  -->

                    </TabControl>
                </Grid>
            </TabItem>
            <!-- Вкладка 6: Автозагрузка -->
        <!--   <TabItem Header="Автозагрузка и Фон">

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="15*"/>
                        <ColumnDefinition Width="278*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="10,10,10,10" Grid.ColumnSpan="2">
                        <Button Content="  🔄   Обновить список автозагрузки"
Command="{Binding LoadStartupProgramsCommand}"
HorizontalAlignment="Left"/>
                        <Button Content="  ⚙  ️ Открыть настройки автозагрузки"
Command="{Binding OpenStartupSettingsCommand}"
Margin="10,0,0,0" Background="#FF17A2B8"/>
                    </StackPanel>
                    <GroupBox Grid.Row="1" Header="Программы, запускаемые при старте Windows" Margin="10,10,10,10" Grid.ColumnSpan="2">
                        <DataGrid ItemsSource="{Binding StartupPrograms}"
AutoGenerateColumns="False"
IsReadOnly="True"
ScrollViewer.VerticalScrollBarVisibility="Auto">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Название" Binding="{Binding Name}" Width="2*"/>
                                <DataGridTextColumn Header="Команда (Путь)" Binding="{Binding Command}" Width="4*"/>
                                <DataGridTextColumn Header="Расположение" Binding="{Binding Location}" Width="1*"/>
                                <DataGridTextColumn Header="Пользователь" Binding="{Binding User}" Width="1*"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </GroupBox>
                </Grid>
            </TabItem>-->
            <!-- Вкладка 7: Безопасность -->
            <TabItem Header="Безопасность" Height="32" VerticalAlignment="Top">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <GroupBox Grid.Row="0" Header=" 🛡 ️ Обнаруженный антивирус" Margin="10,10,10,5">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Grid Grid.Column="0" Margin="10">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Антивирус:" FontWeight="Bold" Margin="0,0,5,0"/>
                                <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding AntivirusInfo.Name}" FontWeight="SemiBold"/>
                                <TextBlock Grid.Row="0" Grid.Column="2" Text="Производитель:" FontWeight="Bold" Margin="10,0,5,0"/>
                                <TextBlock Grid.Row="0" Grid.Column="3" Text="{Binding AntivirusInfo.Vendor}"/>
                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Статус:" FontWeight="Bold" Margin="0,5,5,0"/>
                                <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding AntivirusInfo.Status}" FontWeight="SemiBold">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding AntivirusInfo.Status}" Value="Активен">
                                                    <Setter Property="Foreground" Value="Green"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding AntivirusInfo.Status}" Value="Неактивен">
                                                    <Setter Property="Foreground" Value="Red"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                                <TextBlock Grid.Row="1" Grid.Column="2" Text="Защита в реальном времени:" FontWeight="Bold" Margin="10,5,5,0"/>
                                <TextBlock Grid.Row="1" Grid.Column="3" Text="{Binding AntivirusInfo.RealTimeProtection}" Margin="0,5,0,0">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding AntivirusInfo.RealTimeProtection}" Value="Включена">
                                                    <Setter Property="Foreground" Value="Green"/>
                                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding AntivirusInfo.RealTimeProtection}" Value="Выключена">
                                                    <Setter Property="Foreground" Value="Red"/>
                                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Обновления:" FontWeight="Bold" Margin="0,5,5,0"/>
                                <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding AntivirusInfo.IsUpToDate, Converter={StaticResource BoolToTextConverter}, ConverterParameter='Актуальны|Требуются'}" Margin="0,5,0,0">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding AntivirusInfo.IsUpToDate}" Value="True">
                                                    <Setter Property="Foreground" Value="Green"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding AntivirusInfo.IsUpToDate}" Value="False">
                                                    <Setter Property="Foreground" Value="Orange"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                                <TextBlock Grid.Row="2" Grid.Column="2" Text="Последнее обновление:" FontWeight="Bold" Margin="10,5,5,0"/>
                                <TextBlock Grid.Row="2" Grid.Column="3" Text="{Binding AntivirusInfo.LastUpdate, StringFormat='dd.MM.yyyy HH:mm', TargetNullValue='Неизвестно'}" Margin="0,5,0,0"/>
                            </Grid>
                            <StackPanel Grid.Column="1" Orientation="Vertical" MinWidth="200" Margin="10">
                                <Button Content=" 🔄  Обновить статус АВ"
            Command="{Binding RefreshAntivirusInfoCommand}"
            Margin="5"
            Background="#FF17A2B8"/>
                                <Button Content=" 🚀  Комплексная проверка"
            Command="{Binding PerformComprehensiveSecurityScanCommand}"
            IsEnabled="{Binding IsQuickScanInProgress, Converter={StaticResource InverseBooleanConverter}}"
            Margin="5"
            Background="#FF28A745"
            FontWeight="Bold"/>

                                <Button Content=" 🛡 ️ Запустить проверку Защитника"
            Command="{Binding StartDefenderScanCommand}"
            IsEnabled="{Binding IsDefenderScanInProgress, Converter={StaticResource InverseBooleanConverter}}"
            Margin="5"
            Background="#FF0078D7"
            Visibility="{Binding AntivirusInfo.Name, ConverterParameter=Defender, Converter={StaticResource ContainsStringVisibilityConverter}}"/>

                                <ProgressBar Height="20" Margin="5"
            Visibility="{Binding IsQuickScanInProgress, Converter={StaticResource BoolToVisibilityConverter}}"
            IsIndeterminate="True"/>
                            </StackPanel>
                        </Grid>
                    </GroupBox>
                    <GroupBox Grid.Row="1" Header=" 📊  Статус безопасности системы" Margin="10,5,10,5">
                        <Grid Height="37">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="10">
                                <TextBlock Text="Общий статус:" FontWeight="Bold" Margin="0,0,5,0"/>
                                <TextBlock Text="{Binding SecurityScanResult.OverallStatus}" FontWeight="Bold" FontSize="14">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding SecurityScanResult.OverallStatus}" Value="Защищено">
                                                    <Setter Property="Foreground" Value="Green"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding SecurityScanResult.OverallStatus}" Value="Требуется внимание">
                                                    <Setter Property="Foreground" Value="Orange"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding SecurityScanResult.OverallStatus}" Value="Критический риск">
                                                    <Setter Property="Foreground" Value="Red"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                                <TextBlock Text=" | " Margin="10,0"/>
                                <TextBlock Text="Угроз:" FontWeight="Bold" Margin="0,0,5,0"/>
                                <TextBlock Text="{Binding SecurityScanResult.TotalThreats}" FontWeight="Bold" Foreground="Red"/>
                                <TextBlock Text=" | " Margin="10,0"/>
                                <TextBlock Text="Критических:" FontWeight="Bold" Margin="0,0,5,0"/>
                                <TextBlock Text="{Binding SecurityScanResult.CriticalIssues}" FontWeight="Bold" Foreground="DarkRed"/>
                                <TextBlock Text=" | " Margin="10,0"/>
                                <TextBlock Text="Предупреждений:" FontWeight="Bold" Margin="0,0,5,0"/>
                                <TextBlock Text="{Binding SecurityScanResult.Warnings}" FontWeight="Bold" Foreground="Orange"/>
                            </StackPanel>
                            <TextBlock Grid.Column="1" Text="{Binding QuickScanStatus}"
Margin="10" VerticalAlignment="Center" FontWeight="SemiBold" Foreground="Blue"/>
                        </Grid>
                    </GroupBox>
                    <GroupBox Grid.Row="2" Header="🔍 Результаты проверок безопасности" Margin="10,5,10,5">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,5" HorizontalAlignment="Right">
                                <TextBlock Text="Фильтр:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                <RadioButton Content="Все" IsChecked="True" 
                         Command="{Binding SetSecurityFilterAllCommand}" 
                         Margin="5,0"/>
                                <RadioButton Content="Только риски" Foreground="Red" FontWeight="Bold"
                         Command="{Binding SetSecurityFilterRisksCommand}" 
                         Margin="5,0"/>
                                <RadioButton Content="Безопасные" Foreground="Green"
                         Command="{Binding SetSecurityFilterSafeCommand}" 
                         Margin="5,0"/>
                            </StackPanel>

                            <DataGrid Grid.Row="1" 
                  ItemsSource="{Binding DisplayedSecurityChecks}"
                  AutoGenerateColumns="False"
                  IsReadOnly="True"
                  ScrollViewer.VerticalScrollBarVisibility="Auto">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Проверка" Binding="{Binding CheckName}" Width="2*"/>
                                    <DataGridTextColumn Header="Категория" Binding="{Binding Category}" Width="1*"/>
                                    <DataGridTextColumn Header="Статус" Binding="{Binding Status}" Width="1.5*">
                                        <DataGridTextColumn.ElementStyle>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="FontWeight" Value="SemiBold"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsCritical}" Value="True">
                                                        <Setter Property="Foreground" Value="Red"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Status}" Value="ОК">
                                                        <Setter Property="Foreground" Value="Green"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Status}" Value="ВНИМАНИЕ">
                                                        <Setter Property="Foreground" Value="Orange"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </DataGridTextColumn.ElementStyle>
                                    </DataGridTextColumn>
                                    <DataGridTextColumn Header="Детали" Binding="{Binding Details}" Width="3*"/>
                                    <DataGridTextColumn Header="Рекомендация" Binding="{Binding Recommendation}" Width="2.5*"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </Grid>
                    </GroupBox>

                    <GroupBox Grid.Row="3" Header=" 🚨  Обнаруженные угрозы и уязвимости" Margin="10,5,10,5">
                        <DataGrid ItemsSource="{Binding SecurityScanResult.Threats}"
AutoGenerateColumns="False"
IsReadOnly="True"
ScrollViewer.VerticalScrollBarVisibility="Auto"
VirtualizingPanel.IsVirtualizing="True">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Угроза" Binding="{Binding Name}" Width="2*"/>
                                <DataGridTextColumn Header="Тип" Binding="{Binding Type}" Width="1*"/>
                                <DataGridTextColumn Header="Важность" Binding="{Binding Severity}" Width="1*">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="HorizontalAlignment" Value="Center"/>
                                            <Setter Property="FontWeight" Value="Bold"/>
                                            <Setter Property="Padding" Value="8,4"/>

                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Severity}" Value="Критическая">
                                                    <Setter Property="Background" Value="#FFDC3545"/>
                                                    <Setter Property="Foreground" Value="White"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Severity}" Value="Высокая">
                                                    <Setter Property="Background" Value="#FFFD7E14"/>
                                                    <Setter Property="Foreground" Value="White"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Severity}" Value="Средняя">
                                                    <Setter Property="Background" Value="#FFFFC107"/>
                                                    <Setter Property="Foreground" Value="Black"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Severity}" Value="Низкая">
                                                    <Setter Property="Background" Value="#FF17A2B8"/>
                                                    <Setter Property="Foreground" Value="White"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="Описание" Binding="{Binding Description}" Width="3*"/>
                                <DataGridTextColumn Header="Расположение" Binding="{Binding FilePath}" Width="2*"/>
                                <DataGridTextColumn Header="Рекомендация" Binding="{Binding Recommendation}" Width="2*"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </GroupBox>

                    <GroupBox Grid.Row="4" Header=" 📰  Журнал событий безопасности (Windows)" Margin="10,5,10,10">
                        <DataGrid ItemsSource="{Binding SecurityEvents}"
AutoGenerateColumns="False"
IsReadOnly="True"
ScrollViewer.VerticalScrollBarVisibility="Auto"
VirtualizingPanel.IsVirtualizing="True">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Время" Binding="{Binding TimeGenerated, StringFormat='dd.MM.yy HH:mm'}" Width="1.5*"/>
                                <DataGridTextColumn Header="Событие" Binding="{Binding EventType}" Width="2*"/>
                                <DataGridTextColumn Header="Источник" Binding="{Binding Source}" Width="2*"/>
                                <DataGridTextColumn Header="Важность" Binding="{Binding Severity}" Width="1*">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="FontWeight" Value="Bold"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Severity}" Value="Высокая">
                                                    <Setter Property="Foreground" Value="Red"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Severity}" Value="Средняя">
                                                    <Setter Property="Foreground" Value="Orange"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Severity}" Value="Информация">
                                                    <Setter Property="Foreground" Value="Blue"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="Описание" Binding="{Binding Description}" Width="5*"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </GroupBox>
                </Grid>
            </TabItem>
        </TabControl>

        <!-- Нижний колонтитул с кнопками -->
        <Border Grid.Row="2" Background="#FFE1E1E1" Padding="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0"
                          VerticalAlignment="Center" FontStyle="Italic" Foreground="#FF6C757D">
                    <Run Text=" v"/>
                    <Run Language="ru-ru" Text="1"/>
                    <Run Text=".0 - проект по информационной безопасности"/>
                </TextBlock>

                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Content="📊 Сформировать отчет" Command="{Binding GenerateReportCommand}" Background="#FF17A2B8" Margin="5,0"/>
                    <Button Content="❓ Справка / О программе" Command="{Binding ShowAboutCommand}"
                            Background="#FF6C757D" Margin="5,0"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>